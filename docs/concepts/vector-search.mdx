---
title: "Vector search"
---

Vector search is the essential feature of TopK. With that in mind, TopK is designed to:

* Handle **billion-scale vector search** efficiently across massive datasets
* Achieve **> 95% recall** in vector search â€” consistently retrieving more than 95% of the true top-K nearest neighbors on practical workloads
* Provide **low latency** (\<100ms) for any query across datasets of any size

## How to perform a vector search

Vector search is enabled by adding a [`vector_index()`](/collections/create#vector-index) to a vector field in the collection schema:

<CodeGroup>

```python Python
from topk_sdk.schema import text, f32_vector, vector_index

client.collections().create(
    "books",
    schema={
        "title": text().required(),
        "title_embedding": f32_vector().required().index(vector_index(dimension=1536))
    },
)
```


```typescript Javascript
import { text, f32Vector, vectorIndex } from "topk-js/schema";

await client.collections().create("books", {
  title: text().required(),
  title_embedding: f32Vector().required().index(vectorIndex({ metric: "cosine" }))
});
```

</CodeGroup>

Then, we can perform vector search by using the `vector_distance()` function to compute distance between the query vector and vector stored in the document:

<CodeGroup>

```python Python
from topk_sdk.query import select, fn

docs = client.collection("books").query(
    select(
        "title",
        published_year=field("published_year"),
        # Compute vector distance between the embedding "epic fantasy adventure" and the `title_embedding` field.
        title_similarity=fn.vector_distance("title_embedding", [0.1, 0.2, 0.3, ...])
    )
    # Return top 10 results with the highest similarity
    .topk(field("title_similarity"), 10)
)

# Example results:
[
  {
    "_id": "2",
    "title": "Lord of the Rings",
    "title_similarity": 0.8150404095649719
  },
  {
    "_id": "1",
    "title": "The Catcher in the Rye",
    "title_similarity": 0.7825378179550171,
  }
]
```


```js Javascript
import { select, fn, field } from "topk-js/query";

const docs = await client.collection("books").query(
  select({
    title: field("title"),
    published_year: field("published_year"),
    title_similarity: fn.vectorDistance(
      "title_embedding",
      [0.1, 0.2, 0.3 /* embedding for "epic fantasy adventure" */]
    ),
  }).topk(field("title_similarity"), 10)
);

// Example results:
[
  {
    _id: '2',
    title: 'Lord of the Rings',
    title_similarity: 0.8150404095649719
  },
  {
    _id: '1'
    title_similarity: 0.7825378179550171,
    title: 'The Catcher in the Rye',
  }
]
```

</CodeGroup>

Let's break down the example above:

1. First we compute the cosine distance between the query embedding and the `title_embedding` field by using the `vector_distance` function.
2. Then we store the computed cosine distance in the `title_similarity` field.
3. Lastly, we return the top 10 results by the `title_similarity` field in descending order.

## Combinding vector search with metadata filtering

While vector search captures semantic similarity, it often needs to be combined with **metadata filtering** to enforce hard constraints based on crieteria such as
category, time range, price range, availability, user permissions, language, or geographic region.

In TopK, you can combine vector search with metadata filtering by combining `vector_distance()` function with the `filter()` function:

<CodeGroup>

```python Python
from topk_sdk.query import select, fn

docs = client.collection("books").query(
    select(
        "title",
        title_similarity=fn.vector_distance("title_embedding", [0.1, 0.2, 0.3, ...]),
        published_year=field("published_year"),
    )
    .filter(field("published_year") > 2000)
    .topk(field("title_similarity"), 10)
)
```

```js Javascript
import { select, fn, field } from "topk-js/query";

const docs = await client.collection("books").query(
  select({
    title: field("title"),
    title_similarity: fn.vectorDistance(
      "title_embedding",
      [0.1, 0.2, 0.3 /* ... */]
    ),
    published_year: field("published_year"),
  })
    .filter(field("published_year").gt(2000))
    .topk(field("title_similarity"), 10)
);
```

</CodeGroup>
